dist: bionic
language: php

php:
  - '7.3'

services:
  - mysql

before_install:
  - composer self-update
  - composer validate

install:
  - composer install --no-interaction
  - npm clean-install
  - npm run dev

before_script:
  - sudo chown -R www-data:www-data "$TRAVIS_BUILD_DIR/resources/test-skel"
  - sudo chown -R root:root "$TRAVIS_BUILD_DIR/resources/test-skel/protected"
  - sudo chmod 600 "$TRAVIS_BUILD_DIR/resources/test-skel/protected/forbidden"
  - mysql -e 'CREATE DATABASE servidor_test;'
  - cp .env.travis .env
  - php artisan key:generate
  - php artisan migrate
  - php artisan passport:install

after_failure:
  - cat storage/logs/laravel.log

notifications:
  irc:
    channels:
      - "chat.freenode.net#servidor"
    template:
      - "Build #%{build_number} (%{branch} @ %{commit} by %{author}) - %{message}"
      - "Details: %{build_url}"
